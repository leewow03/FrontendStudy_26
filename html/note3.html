<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>í”„ë¡œí˜• ì¼ì • ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --calendar-border: #dee2e6; --google-blue: #1a73e8; }
        body { background-color: #fff; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        .main-wrapper { display: flex; flex: 1; overflow: hidden; border-top: 1px solid var(--calendar-border); }

        /* ì™¼ìª½ ë‹¬ë ¥ */
        .calendar-section { flex: 1; padding: 20px; overflow-y: auto; }
        .row-cols-7 > * { flex: 0 0 auto; width: 14.285714%; }
        .calendar-day {
            aspect-ratio: 1.2 / 1; border: 1px solid transparent; cursor: pointer;
            border-radius: 8px; transition: 0.2s; position: relative; display: flex;
            align-items: center; justify-content: center; font-size: 1.1rem;
        }
        .calendar-day:hover { background-color: #f1f3f4; }
        .calendar-day.selected { background-color: #e8f0fe; border-color: var(--google-blue); color: var(--google-blue); font-weight: bold; }
        .has-todo::after { content: ''; position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%); width: 5px; height: 5px; background-color: var(--google-blue); border-radius: 50%; }

        /* ì˜¤ë¥¸ìª½ ì‚¬ì´ë“œë°” (Aside) */
        aside { width: 400px; background-color: #fff; display: flex; flex-direction: column; border-left: 1px solid var(--calendar-border); }

        /* ìƒë‹¨: ì„ íƒ ë‚ ì§œ ì…ë ¥ë¶€ */
        .aside-top { padding: 20px; border-bottom: 2px solid #f1f3f4; flex-shrink: 0; }

        /* í•˜ë‹¨: ì „ì²´ ì¼ì • ë¦¬ìŠ¤íŠ¸ (ìŠ¤í¬ë¡¤ ê°€ëŠ¥ ì˜ì—­) */
        .aside-bottom { flex: 1; overflow-y: auto; padding: 20px; background-color: #fafafa; }

        .todo-group-title { font-size: 0.85rem; font-weight: bold; color: #70757a; margin-top: 15px; margin-bottom: 8px; display: block; }
        .todo-item {
            display: flex; align-items: center; padding: 10px; border-radius: 6px;
            margin-bottom: 5px; background-color: #fff; border: 1px solid #eee; font-size: 0.9rem;
        }
        .todo-item.completed { opacity: 0.6; }
        .todo-item.completed .todo-text { text-decoration: line-through; }
        .date-badge { font-size: 0.7rem; padding: 2px 6px; background: #e8f0fe; color: #1a73e8; border-radius: 4px; margin-left: auto; }
    </style>
</head>
<body>

<header class="p-3 d-flex justify-content-between align-items-center bg-white shadow-sm">
    <h4 class="mb-0 text-primary fw-bold">ğŸ“… ìŠ¤ë§ˆíŠ¸ ìº˜ë¦°ë”</h4>
    <div class="d-flex align-items-center">
        <button class="btn btn-outline-secondary btn-sm me-2" id="prevMonth"><</button>
        <h5 id="currentMonth" class="mb-0 me-2 fw-bold"></h5>
        <button class="btn btn-outline-secondary btn-sm" id="nextMonth">></button>
    </div>
</header>

<div class="main-wrapper">
    <main class="calendar-section">
        <div class="row row-cols-7 g-1 text-center fw-bold text-muted mb-3">
            <div class="col text-danger">ì¼</div>
            <div class="col">ì›”</div>
            <div class="col">í™”</div>
            <div class="col">ìˆ˜</div>
            <div class="col">ëª©</div>
            <div class="col">ê¸ˆ</div>
            <div class="col text-primary">í† </div>
        </div>
        <div id="calendarDays" class="row row-cols-7 g-1"></div>
    </main>

    <aside>
        <div class="aside-top">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 id="selectedFullDate" class="fw-bold mb-0 text-primary">ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”</h5>
            </div>
            <div class="input-group">
                <input type="text" id="todoInput" class="form-control" placeholder="ìƒˆ ì¼ì • ì¶”ê°€...">
                <button class="btn btn-primary" id="addTodoBtn">ì¶”ê°€</button>
            </div>
        </div>

        <div class="aside-bottom">
            <h6 class="fw-bold mb-3"><i class="bi bi-list-task"></i> ì „ì²´ ì¼ì • ëª©ë¡</h6>
            <div id="allTodoList">
            </div>
        </div>
    </aside>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script>
    let viewDate = new Date();
    let selectedDateStr = "";
    let todoData = JSON.parse(localStorage.getItem('calendar_todos_v3')) || {};

    function renderCalendar() {
        const year = viewDate.getFullYear();
        const month = viewDate.getMonth();
        $('#currentMonth').text(`${year}ë…„ ${month + 1}ì›”`);

        const firstDay = new Date(year, month, 1).getDay();
        const lastDate = new Date(year, month + 1, 0).getDate();
        let html = '';
        for (let i = 0; i < firstDay; i++) html += '<div class="col"><div class="calendar-day opacity-0"></div></div>';

        for (let d = 1; d <= lastDate; d++) {
            const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
            const hasTodo = todoData[dateStr] && todoData[dateStr].length > 0;
            const isSelected = selectedDateStr === dateStr ? 'selected' : '';
            html += `<div class="col text-center"><div class="calendar-day ${isSelected} ${hasTodo ? 'has-todo' : ''}" data-date="${dateStr}">${d}</div></div>`;
        }
        $('#calendarDays').html(html);
    }

    // í•µì‹¬: ì „ì²´ ì¼ì •ì„ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
    function renderAllTodos() {
        const $container = $('#allTodoList');
        $container.empty();

        // 1. ë‚ ì§œí‚¤ë“¤ì„ ì •ë ¬ (íŒŒì´ì¬ì˜ sorted(todoData.keys())ì™€ ê°™ìŒ)
        const sortedDates = Object.keys(todoData).sort();

        if (sortedDates.length === 0) {
            $container.append('<p class="text-center text-muted small mt-4">ì €ì¥ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</p>');
            return;
        }

        sortedDates.forEach(date => {
            const tasks = todoData[date];
            if (tasks.length === 0) return;

            // ë‚ ì§œ í—¤ë” ì¶”ê°€
            $container.append(`<span class="todo-group-title">${date}</span>`);

            tasks.forEach((todo, index) => {
                $container.append(`
                    <div class="todo-item ${todo.completed ? 'completed' : ''}">
                        <input type="checkbox" class="form-check-input me-2"
                               ${todo.completed ? 'checked' : ''}
                               onclick="toggleTodo('${date}', ${index})">
                        <span class="todo-text flex-grow-1">${todo.text}</span>
                        <button class="btn btn-link text-danger btn-sm p-0" onclick="deleteTodo('${date}', ${index})">Ã—</button>
                    </div>
                `);
            });
        });
    }

    // ê¸°ëŠ¥ ë¡œì§ (ë‚ ì§œë¥¼ ì¸ìë¡œ ë°›ë„ë¡ ìˆ˜ì •)
    window.toggleTodo = function(date, index) {
        todoData[date][index].completed = !todoData[date][index].completed;
        saveAndRefresh();
    };

    window.deleteTodo = function(date, index) {
        todoData[date].splice(index, 1);
        if (todoData[date].length === 0) delete todoData[date];
        saveAndRefresh();
    };

    $('#addTodoBtn').click(function() {
        const text = $('#todoInput').val().trim();
        if (!selectedDateStr) return alert('ë‹¬ë ¥ì—ì„œ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!');
        if (text) {
            if (!todoData[selectedDateStr]) todoData[selectedDateStr] = [];
            todoData[selectedDateStr].push({ text: text, completed: false });
            $('#todoInput').val('');
            saveAndRefresh();
        }
    });

    function saveAndRefresh() {
        localStorage.setItem('calendar_todos_v3', JSON.stringify(todoData));
        renderCalendar();
        renderAllTodos();
    }

    $(document).on('click', '.calendar-day:not(.opacity-0)', function() {
        selectedDateStr = $(this).data('date');
        $('#selectedFullDate').text(selectedDateStr);
        renderCalendar();
    });

    $('#prevMonth, #nextMonth').click(function() {
        viewDate.setMonth(viewDate.getMonth() + (this.id === 'prevMonth' ? -1 : 1));
        renderCalendar();
    });

    // ì´ˆê¸° ì‹¤í–‰
    renderCalendar();
    renderAllTodos();
</script>
</body>
</html>