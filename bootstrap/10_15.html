<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>온라인 예약 시스템</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --primary-color: #0d6efd; --success-color: #198754; }
        .row-cols-7 > * { flex: 0 0 auto; width: 14.285714%; }
        .calendar-day {
            aspect-ratio: 1 / 1;
            border: 1px solid #dee2e6;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }
        .calendar-day:hover:not(.disabled):not(.selected) { background-color: #e7f1ff; }
        .calendar-day.selected { background-color: var(--primary-color) !important; color: white !important; font-weight: bold; }
        .calendar-day.disabled { background-color: #f8f9fa; color: #adb5bd; cursor: not-allowed; border-color: #eee; }
        .calendar-empty { aspect-ratio: 1 / 1; }
        .time-slot { cursor: pointer; transition: all 0.2s; border-radius: 6px; border: 1px solid #dee2e6; padding: 10px; text-align: center; }
        .time-slot:hover:not(.disabled) { border-color: var(--primary-color); background-color: #e7f1ff; }
        .time-slot.selected { background-color: var(--success-color) !important; color: white !important; border-color: var(--success-color) !important; }
        .time-slot.disabled { background-color: #f8f9fa; color: #adb5bd; cursor: not-allowed; opacity: 0.6; }
    </style>
</head>
   <body class="bg-light"> <div class="container py-5"> <div class="row g-4"> <div class="col-lg-8">

                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-primary text-white py-3">머리 예약</div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <button class="btn btn-outline-primary" id="prevMonth">이전달</button>
                            <h4 id="currentMonth" class="mb-0 fw-bold"></h4>
                            <button class="btn btn-outline-primary" id="nextMonth">다음달</button>
                        </div>
                        <div class="row row-cols-7 g-2 text-center mb-2 fw-bold text-muted">
                            <div class="col text-danger">일</div>
                            <div class="col">월</div>
                            <div class="col">화</div>
                            <div class="col">수</div>
                            <div class="col">목</div>
                            <div class="col">금</div>
                            <div class="col text-primary">토</div>
                        </div>
                        <div id="calendarDays" class="row row-cols-7 g-2"></div>
                    </div>
                </div>

                <div class="card shadow-sm" id="timeSlotSection" style="display: none;">
                    <div class="card-header bg-success text-white py-3">
                        <h5 class="mb-0">2. 시간 선택</h5>
                    </div>
                    <div class="card-body">
                        <div id="timeSlots" class="row g-2"></div>
                    </div>
                </div>

            </div> <div class="col-lg-4">
                <div class="card sticky-top shadow" style="top: 20px;">
                    <div class="card-header bg-dark text-white py-3">
                        <h5 class="mb-0">3. 예약 정보 입력</h5>
                    </div>
                    <div class="card-body">
                        <form id="reservationForm">
                            <div class="mb-3">
                                <label class="form-label small fw-bold text-muted">선택된 일정</label>
                                <div class="input-group mb-2">
                                    <span class="input-group-text small">날짜</span>
                                    <input type="text" class="form-control bg-white" id="selectedDate" readonly required>
                                </div>
                                <div class="input-group">
                                    <span class="input-group-text small">시간</span>
                                    <input type="text" class="form-control bg-white" id="selectedTime" readonly required>
                                </div>
                            </div>

                            <hr> <div class="mb-3">
                                <label class="form-label small fw-bold">서비스 항목</label>
                                <select class="form-select" id="serviceSelect" required>
                                    <option value="">서비스를 선택해 주세요</option>
                                    <option value="cut">커트 (30분)</option>
                                    <option value="perm">펌 (120분)</option>
                                    <option value="color">염색 (90분)</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label class="form-label small fw-bold">예약자 성함</label>
                                <input type="text" class="form-control" id="userName" placeholder="성함을 입력하세요" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label small fw-bold">연락처</label>
                                <input type="tel" class="form-control" id="userPhone" placeholder="010-0000-0000" required>
                            </div>

                            <button type="submit" class="btn btn-primary w-100 py-3 fw-bold mt-2" id="submitBtn" disabled>
                                예약 확정하기
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </body>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
    $(document).ready(function() {
        let currentDate = new Date();
        let selectedDate = null;
        let selectedTime = null;

        // 임시 데이터 (나중에 파이썬 서버에서 가져올 부분)
        const disabledDates = ['2026-02-14', '2026-02-15'];
        const bookedSlots = {
            '2026-02-06': ['09:00', '10:30', '14:00'],
            '2026-02-10': ['11:00', '15:00']
        };

        // [함수] 폼 유효성 검사 (버튼 활성화 로직)
        function validateForm() {
            const isDateSelected = !!$('#selectedDate').val();
            const isTimeSelected = !!$('#selectedTime').val();
            const isServiceSelected = !!$('#serviceSelect').val();
            const isNameEntered = $('#userName').val().trim() !== '';
            const isPhoneEntered = $('#userPhone').val().trim() !== '';

            // 모든 조건이 충족되어야 버튼 활성화
            const isValid = isDateSelected && isTimeSelected && isServiceSelected && isNameEntered && isPhoneEntered;
            $('#submitBtn').prop('disabled', !isValid);
        }

        // [함수] 달력 렌더링
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            $('#currentMonth').text(`${year}년 ${month + 1}월`);

            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            today.setHours(0,0,0,0);

            let html = '';
            for (let i = 0; i < firstDay; i++) {
                html += '<div class="col"><div class="calendar-empty"></div></div>';
            }

            for (let d = 1; d <= lastDate; d++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                const targetDate = new Date(year, month, d);
                const isPast = targetDate < today;
                const isDisabled = disabledDates.includes(dateStr) || isPast;

                html += `
                    <div class="col">
                        <div class="calendar-day ${isDisabled ? 'disabled' : ''} ${selectedDate === dateStr ? 'selected' : ''}"
                             data-date="${dateStr}">
                            ${d}
                        </div>
                    </div>`;
            }
            $('#calendarDays').html(html);
        }

        // [함수] 시간대 렌더링
        function renderTimeSlots(date) {
            const slots = [];
            for (let h = 9; h < 18; h++) {
                for (let m = 0; m < 60; m += 30) {
                    slots.push(`${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`);
                }
            }

            const booked = bookedSlots[date] || [];
            let html = '';
            slots.forEach(slot => {
                const isBooked = booked.includes(slot);
                html += `
                    <div class="col-4 col-md-3">
                        <div class="time-slot ${isBooked ? 'disabled' : ''} ${selectedTime === slot ? 'selected' : ''}"
                             data-time="${slot}">
                            ${slot}
                        </div>
                    </div>`;
            });
            $('#timeSlots').html(html);
            $('#timeSlotSection').show();
        }

        // --- 이벤트 리스너 ---

        // 날짜 클릭
        $(document).on('click', '.calendar-day:not(.disabled)', function() {
            $('.calendar-day').removeClass('selected');
            $(this).addClass('selected');
            selectedDate = $(this).data('date');

            // 날짜가 바뀌면 시간 선택 초기화
            selectedTime = null;
            $('#selectedDate').val(selectedDate);
            $('#selectedTime').val('');

            renderTimeSlots(selectedDate);
            validateForm();
        });

        // 시간 클릭
        $(document).on('click', '.time-slot:not(.disabled)', function() {
            $('.time-slot').removeClass('selected');
            $(this).addClass('selected');
            selectedTime = $(this).data('time');
            $('#selectedTime').val(selectedTime);
            validateForm();
        });

        // 입력 필드 변경 시 감지
        $('#userName, #userPhone, #serviceSelect').on('input change', validateForm);

        // 월 이동
        $('#prevMonth, #nextMonth').click(function() {
            currentDate.setMonth(currentDate.getMonth() + (this.id === 'prevMonth' ? -1 : 1));
            renderCalendar();
            $('#timeSlotSection').hide(); // 월 바꾸면 시간 선택창 숨김
        });

        // 폼 제출
        $('#reservationForm').submit(function(e) {
            e.preventDefault();
            const formData = {
                date: selectedDate,
                time: selectedTime,
                service: $('#serviceSelect').val(),
                name: $('#userName').val(),
                phone: $('#userPhone').val()
            };
            console.log("서버로 전송될 데이터:", formData);
            alert(`예약이 완료되었습니다!\n${formData.name}님 (${formData.date} ${formData.time})`);
            location.reload();
        });

        renderCalendar();
    });
    </script>
</body>
</html>